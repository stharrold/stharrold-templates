# Example Azure DevOps pipeline demonstrating secrets management
# This is a reference/template - customize for your actual pipelines

trigger: none  # Manual trigger only (this is just an example)

pool:
  vmImage: 'ubuntu-latest'

# Define variables from Azure DevOps variable groups or pipeline variables
# Configure these in: Pipelines > Library > Variable groups
# Or: Pipeline settings > Variables
variables:
  - group: 'secrets-group'  # Variable group containing DB_PASSWORD, API_KEY, etc.

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.11'
    displayName: 'Use Python 3.11'

  - script: |
      curl -LsSf https://astral.sh/uv/install.sh | sh
      echo "##vso[task.prependpath]$HOME/.local/bin"
    displayName: 'Install uv'

  - script: uv run scripts/run.py uv run pytest
    displayName: 'Run tests with secrets'
    env:
      # Map pipeline variables to environment variables
      # TF_BUILD is automatically set - run.py detects Azure DevOps
      DB_PASSWORD: $(DB_PASSWORD)
      API_KEY: $(API_KEY)
      ANALYTICS_TOKEN: $(ANALYTICS_TOKEN)

  - script: uv run scripts/run.py python -c "import os; print('Secrets loaded')"
    displayName: 'Verify secrets available'
    env:
      DB_PASSWORD: $(DB_PASSWORD)
      API_KEY: $(API_KEY)
