["workflow:v7x1_1-worktree"]
description = "Create worktree for development (Step 1 of 4)"
prompt = """
# /workflow:v7x1_1-worktree - Step 1 of 4

**v7x1 Workflow**: `/workflow:v7x1_1-worktree` â†’ Implementation â†’ `/workflow:v7x1_2-integrate` â†’ `/workflow:v7x1_3-release` â†’ `/workflow:v7x1_4-backmerge`

**Purpose**: Create git worktree for isolated development.

**Prerequisites**: Main repo, `contrib/*` branch

**Outputs**: Feature worktree with instructions for implementation

---

## Usage

```
/workflow:v7x1_1-worktree "feature description"
```

Example:
```
/workflow:v7x1_1-worktree "add user authentication with JWT tokens"
```

---

## Step 1: Extract Feature Slug

Parse the feature description to create a kebab-case slug:
- Convert to lowercase
- Replace spaces with hyphens
- Remove special characters
- Limit to 50 characters

Example: "Add User Authentication" -> "add-user-authentication"

## Step 2: Create Feature Worktree

Create worktree using the git-workflow-manager script:

```bash
uv run python .claude/skills/git-workflow-manager/scripts/create_worktree.py \
  feature {slug} contrib/stharrold
```

This creates:
- Branch: `feature/{timestamp}_{slug}`
- Worktree: `../{project}_feature_{timestamp}_{slug}/`
- State directory: `.gemini-state/` in worktree

---

## Step 3: Record State in AgentDB

```bash
uv run python .claude/skills/agentdb-state-manager/scripts/record_sync.py \
  --sync-type workflow_transition \
  --pattern phase_v7x1_1_worktree \
  --source "main_repo" \
  --target "worktree"
```

---

## Step 4: Display Next Steps

After creating the worktree, display these instructions to the user:

```
[OK] Worktree created for v7x1 workflow

Worktree path: {worktree_path}
Branch: {branch_name}

=== NEXT STEPS ===

1. Exit this session

2. Navigate to the worktree:
   cd {worktree_path}

3. Open a new session and implement the feature using built-in Gemini CLI tools:
   "Implement {original_feature_description}"

4. After implementation is complete, return to main repo:
   cd {main_repo_path}

5. Run integration:
   /workflow:v7x1_2-integrate "{branch_name}"
```

---

## Notes

- Use built-in Gemini CLI tools for planning, architecture, and implementation.
- No manual planning documents required.
- Quality is ensured by autonomous testing and Gemini Code Review.
"

["workflow:v7x1_2-integrate"]
description = "Integrate feature to develop (Step 2 of 4)"
prompt = """
# /workflow:v7x1_2-integrate - Step 2 of 4

**v7x1 Workflow**: `/workflow:v7x1_1-worktree` â†’ Implementation â†’ `/workflow:v7x1_2-integrate` â†’ `/workflow:v7x1_3-release` â†’ `/workflow:v7x1_4-backmerge`

**Purpose**: Create PRs from feature â†’ contrib â†’ develop.

**Prerequisites**: Main repo, `contrib/*` branch, feature implementation complete

**Outputs**: PRs created, worktree cleaned (if full mode)

---

## Usage

### Full Integration (with feature branch)
```
/workflow:v7x1_2-integrate "feature/YYYYMMDDTHHMMSSZ_slug"
```

### Contrib-Only Integration (no feature branch)
```
/workflow:v7x1_2-integrate
```

---

## Mode Detection

- **Full mode**: Branch argument provided (e.g., "feature/20251229T120000Z_auth")
  - Runs: feature â†’ contrib PR, worktree cleanup, contrib â†’ develop PR
- **Contrib-only mode**: No argument provided
  - Runs: contrib â†’ develop PR only

---

## Step 1: Create PR feature â†’ contrib [FULL MODE ONLY]

Skip this step in contrib-only mode.

Push the feature branch and create PR:

```bash
# Push feature branch
git push -u origin {feature_branch}

# Create PR
gh pr create \
  --base contrib/stharrold \
  --head {feature_branch} \
  --title "feat: {slug}" \
  --body "## Summary

Feature implementation using Gemini CLI.

## Changes

[List key changes]

## Test Plan

- [ ] Feature works as expected
- [ ] No regressions introduced
"
```

**MANUAL GATE**: Wait for PR approval and merge in GitHub UI.

After merge, pull latest:
```bash
git checkout contrib/stharrold
git pull origin contrib/stharrold
```

---

## Step 2: Cleanup Feature Worktree [FULL MODE ONLY]

Skip this step in contrib-only mode.

Extract slug from branch name and cleanup:

```bash
uv run python .claude/skills/git-workflow-manager/scripts/cleanup_feature.py {slug}
```

This removes:
- Feature worktree directory
- Local feature branch
- Remote feature branch

---

## Step 3: Create PR contrib â†’ develop

Push contrib and create PR to develop:

```bash
# Push contrib
git push origin contrib/stharrold

# Create PR
gh pr create \
  --base develop \
  --head contrib/stharrold \
  --title "merge: contrib/stharrold to develop" \
  --body "## Summary

Integration of latest changes from contrib branch.

## Checklist

- [ ] All features tested
- [ ] No breaking changes
- [ ] Ready for integration
"
```

**MANUAL GATE**: Wait for PR approval and merge in GitHub UI.

---

## Step 4: Record State in AgentDB

```bash
uv run python .claude/skills/agentdb-state-manager/scripts/record_sync.py \
  --sync-type workflow_transition \
  --pattern phase_v7x1_2_integrate
```

---

## Step 5: Report Completion

Display to user:

```
[OK] Integration complete

{If full mode:}
- Feature PR merged to contrib
- Worktree cleaned up

- Contrib â†’ develop PR created
- Ready for release when develop has enough changes

Next: Run /workflow:v7x1_3-release when ready for production
```

---

## Notes

- Implementation uses built-in Gemini CLI tools.
- PRs require manual approval in GitHub UI.
- Always ends on contrib/* branch (editable).
"

["workflow:v7x1_3-release"]
description = "Release to production (Step 3 of 4)"
prompt = """
# /workflow:v7x1_3-release - Step 3 of 4

**v7x1 Workflow**: `/workflow:v7x1_1-worktree` â†’ Implementation â†’ `/workflow:v7x1_2-integrate` â†’ `/workflow:v7x1_3-release` â†’ `/workflow:v7x1_4-backmerge`

**Purpose**: Create release from develop, create PR to main, tag release.

**Prerequisites**: Main repo, `contrib/*` branch, changes integrated to develop

**Outputs**: Release branch, PR to main, version tag

---

## Usage

```
/workflow:v7x1_3-release
```

Optional: Specify version
```
/workflow:v7x1_3-release v1.2.0
```

---

## Step 1: Calculate Version

If version not provided, calculate next version:

```bash
# Get latest tag
git fetch --tags
latest_tag=$(git describe --tags --abbrev=0 origin/main 2>/dev/null || echo "v0.0.0")

# Bump minor version (default)
# v1.2.3 -> v1.3.0
```

---

## Step 2: Create Release Branch

```bash
uv run python .claude/skills/git-workflow-manager/scripts/release_workflow.py create-release
```

This creates:
- Branch: `release/{version}` from develop
- Pushes branch to origin

---

## Step 3: Create PR to Main

```bash
uv run python .claude/skills/git-workflow-manager/scripts/release_workflow.py pr-main
```

Creates PR from release branch to main.

**MANUAL GATE**: Wait for PR approval and merge in GitHub UI.

---

## Step 4: Tag Release

After PR is merged:

```bash
uv run python .claude/skills/git-workflow-manager/scripts/release_workflow.py tag-release
```

This:
- Creates annotated tag on main
- Pushes tag to origin

---

## Step 5: Record State in AgentDB

```bash
uv run python .claude/skills/agentdb-state-manager/scripts/record_sync.py \
  --sync-type workflow_transition \
  --pattern phase_v7x1_3_release
```

---

## Step 6: Report Completion

Display to user:

```
[OK] Release {version} complete

- Release branch: release/{version}
- PR to main: merged
- Tag: {version} created on main

Next: Run /workflow:v7x1_4-backmerge to sync release to develop
```

---

## Notes

- Release branch is temporary (deleted in backmerge)
- Semantic versioning: vMAJOR.MINOR.PATCH
- Tag is created on main after PR merge
"

["workflow:v7x1_4-backmerge"]
description = "Sync release to develop and contrib (Step 4 of 4)"
prompt = """
# /workflow:v7x1_4-backmerge - Step 4 of 4

**v7x1 Workflow**: `/workflow:v7x1_1-worktree` â†’ Implementation â†’ `/workflow:v7x1_2-integrate` â†’ `/workflow:v7x1_3-release` â†’ `/workflow:v7x1_4-backmerge`

**Purpose**: Sync release changes back to develop and rebase contrib.

**Prerequisites**: Main repo, `contrib/*` branch, release tagged on main

**Outputs**: Release merged to develop, contrib rebased, release branch deleted

---

## Usage

```
/workflow:v7x1_4-backmerge
```

---

## Step 1: Create PR release â†’ develop

```bash
uv run python .claude/skills/git-workflow-manager/scripts/backmerge_workflow.py pr-develop
```

This creates PR from release branch to develop.

**MANUAL GATE**: Wait for PR approval and merge in GitHub UI.

---

## Step 2: Rebase Contrib on Develop

After PR is merged:

```bash
uv run python .claude/skills/git-workflow-manager/scripts/backmerge_workflow.py rebase-contrib
```

This:
- Fetches latest develop
- Rebases contrib/stharrold onto develop
- Force pushes (with lease) to update remote

---

## Step 3: Cleanup Release Branch

```bash
uv run python .claude/skills/git-workflow-manager/scripts/backmerge_workflow.py cleanup-release
```

This:
- Deletes local release branch
- Deletes remote release branch

---

## Step 4: Record State in AgentDB

```bash
uv run python .claude/skills/agentdb-state-manager/scripts/record_sync.py \
  --sync-type workflow_transition \
  --pattern phase_v7x1_4_backmerge
```

---

## Step 5: Report Completion

Display to user:

```
[OK] Backmerge complete

- Release merged to develop
- Contrib rebased on develop
- Release branch cleaned up

Workflow complete! Ready for next feature.
Next: Run /workflow:v7x1_1-worktree "next feature" to start again
```

---

## Notes

- Always ends on contrib/* branch (editable)
- Contrib is rebased to stay current with develop
- Release branch is ephemeral (created in release, deleted in backmerge)
"

[commands.workflow]
description = "Show v7x1 workflow overview"
prompt = """
# /workflow - v7x1 Workflow Overview

The v7x1 workflow simplifies the process by leveraging built-in Gemini CLI tools for implementation.

## Steps

1. **[/workflow:v7x1_1-worktree](command:workflow:v7x1_1-worktree)**
   - Creates a git worktree for isolation.
   - You then use Gemini CLI tools inside the worktree to implement the feature.

2. **[/workflow:v7x1_2-integrate](command:workflow:v7x1_2-integrate)**
   - Integrates the feature branch into `contrib`.
   - Creates a PR from `contrib` to `develop`.

3. **[/workflow:v7x1_3-release](command:workflow:v7x1_3-release)**
   - Creates a release branch from `develop`.
   - Runs quality checks.
   - Creates a PR to `main` and tags the release.

4. **[/workflow:v7x1_4-backmerge](command:workflow:v7x1_4-backmerge)**
   - Merges the release back to `develop`.
   - Rebases `contrib` on the new `develop`.
   - Cleans up the release branch.

## Quick Start

Start a new feature:
```
/workflow:v7x1_1-worktree "Add user authentication"
```
"

[commands.gemini-review]
description = "Reviews a pull request with Gemini CLI"
prompt = """
## Role
You are a world-class autonomous code review agent operating within a GitHub Actions environment.

## Primary Directive
Perform a comprehensive code review of the pull request and post all feedback using the provided MCP tools. Any output not submitted via these tools is lost.

## Input Data
- **Repository**: !{echo $REPOSITORY}
- **Pull Request**: !{echo $PULL_REQUEST_NUMBER}
- **Context**: !{echo $ADDITIONAL_CONTEXT}

## Available Tools (github MCP server)
1. `pull_request_read`: Get PR details, files, and diff.
2. `create_pending_pull_request_review`: Start a new review.
3. `add_comment_to_pending_review`: Add a comment to the review.
4. `submit_pending_pull_request_review`: Finalize the review.

## Instructions
1. **Gather Data**: Call `pull_request_read` with the repository and PR number to retrieve the title, body, file list, and diff.
2. **Analyze**: Review the diff for correctness, security, efficiency, and maintainability.
3. **Start Review**: Call `create_pending_pull_request_review`.
4. **Add Comments**: For each finding, call `add_comment_to_pending_review`.
   - Structure: `ðŸ”´/ðŸŸ /ðŸŸ¡/ðŸŸ¢ [Category] Description`.
   - Include code suggestions if applicable using markdown blocks.
5. **Submit**: Call `submit_pending_pull_request_review` with a summary and event type "COMMENT".

## Constraint
You MUST NOT use shell commands like `gh` or `git` for interaction. Use ONLY the tools listed above.
"
