# Implementation Plan: /workflow/all Command

**Branch**: `005-implement-workflow-all` | **Date**: 2025-11-22 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/005-implement-workflow-all/spec.md`

## Summary

Implement `/workflow/all` - a single command that orchestrates the complete 7-step workflow (0_specify → 6_backmerge), automatically detecting current state, executing steps in sequence, and pausing at manual gates (PR merges). Supports three modes: `new "description"` to start fresh, `release` for production deployment, and default state-detection mode.

## Technical Context

**Language/Version**: Markdown (slash command) + Shell (git/gh commands)
**Primary Dependencies**: Claude Code slash command system, git, gh CLI
**Storage**: N/A (stateless, detects state from git/files)
**Testing**: Manual testing via command execution
**Target Platform**: Claude Code CLI
**Project Type**: Single (slash command file only)
**Performance Goals**: N/A (interactive command)
**Constraints**: Must work with existing 7 workflow commands unchanged
**Scale/Scope**: Single markdown file (~200 lines)

## Constitution Check

**Simplicity**:
- Projects: 1 (slash command only)
- Using framework directly? Yes - standard slash command format
- Single data model? Yes - state detected at runtime
- Avoiding patterns? Yes - no unnecessary abstractions

**Architecture**:
- EVERY feature as library? N/A - this is a command, not a library
- Libraries listed: None needed
- CLI per library: N/A
- Library docs: N/A

**Testing (NON-NEGOTIABLE)**:
- Manual testing via command execution
- Contract tests defined in contracts/all.md
- Integration: Test with actual workflow execution

**Observability**:
- Structured output with step indicators ([▶], [✓], [✗])
- Clear progress reporting
- Error context with retry suggestions

**Versioning**:
- Part of workflow system, follows repo versioning

## Project Structure

### Documentation (this feature)
```
specs/005-implement-workflow-all/
├── plan.md              # This file
├── research.md          # ✓ Complete
├── data-model.md        # ✓ Complete
├── quickstart.md        # ✓ Complete
├── contracts/           # ✓ Complete
│   └── all.md
└── tasks.md             # Generated by /tasks command
```

### Source Code
```
.claude/commands/workflow/
├── 0_specify.md         # Existing
├── 1_plan.md            # Existing
├── 2_tasks.md           # Existing
├── 3_implement.md       # Existing
├── 4_integrate.md       # Existing
├── 5_release.md         # Existing
├── 6_backmerge.md       # Existing
└── all.md               # NEW - to be created
```

**Structure Decision**: Option 1 (Single project) - only one new file needed

## Phase 0: Research - COMPLETE

See [research.md](research.md) for:
- Existing workflow architecture analysis
- Design decisions (modes, state detection, gate handling)
- Implementation approach (slash command only, no Python script)

## Phase 1: Design & Contracts - COMPLETE

See:
- [data-model.md](data-model.md) - WorkflowState, StepResult, ManualGate entities
- [contracts/all.md](contracts/all.md) - Command interface, I/O contract, behavior specs
- [quickstart.md](quickstart.md) - User-facing documentation

## Phase 2: Task Planning Approach

**Task Generation Strategy** (for /tasks command):

1. **Create command file** - `.claude/commands/workflow/all.md`
   - Frontmatter with description and order
   - Three mode handlers (new, release, default)
   - State detection logic
   - Step execution loop
   - Manual gate detection and pause

2. **Implementation sections**:
   - Mode parsing from arguments
   - Branch detection via git
   - Artifact existence checks
   - Slash command invocation for each step
   - Progress output formatting
   - Error handling and reporting

3. **Testing approach**:
   - Test each mode manually
   - Verify state detection accuracy
   - Confirm manual gate pauses work
   - Test error scenarios

**Ordering Strategy**:
- Single file implementation
- Sections in logical order: frontmatter → detection → modes → execution → output

**Estimated Output**: 8-10 tasks covering file creation and testing

## Complexity Tracking

No deviations from constitution - simple single-file implementation.

## Progress Tracking

**Phase Status**:
- [x] Phase 0: Research complete
- [x] Phase 1: Design complete
- [x] Phase 2: Task planning complete (described above)
- [ ] Phase 3: Tasks generated (/tasks command)
- [ ] Phase 4: Implementation complete
- [ ] Phase 5: Validation passed

**Gate Status**:
- [x] Initial Constitution Check: PASS
- [x] Post-Design Constitution Check: PASS
- [x] All NEEDS CLARIFICATION resolved
- [x] Complexity deviations documented (none needed)

---
*Based on Constitution v2.1.1 - See `/memory/constitution.md`*
